{
    "contents" : "---\ntitle: \"Final_Project_Report\"\nauthor: \"Tong Zhang, Zhiqiang Liao\"\ndate: \"August 14, 2015\"\noutput: pdf_document\n---\nDescription: \n  The final Project involves analyzing storms data from NCDC (National Climatic Data Center)'s International Best Track Archive for Climate Stewardship (IBTrACS). We mainly works with data from East Pacific and North Atliantic basins.\n  \nData Source: \n\nThe link below consists data of storms from East Pacific: ftp://eclipse.ncdc.noaa.gov/pub/ibtracs/v03r06/wmo/csv/basin/Basin.EP.ibtracs_wmo.v03r06.csv\nThe link below consists data of storms from North Pacific:\nBasin.NA.ibtracs_hurdat.v03r06.hdat\nftp://eclipse.ncdc.noaa.gov/pub/ibtracs/v03r06/wmo/csv/basin/Basin.NA.ibtracs_wmo.v03r06.csv\n\n\nFor data processing section, we produced two csv files that processed the raw data \nfile for the North Atlantic basin in HURDAT format. The storms.csv based on the data from the HEADER of each storm. It includes id (stroms number since 1851), date, days (number of days in which positions are available), and name. The tracks.csv based on the HEADER and DAILY DATA from each storm. It includes id, date, periond (00h, 06h,12h, 18h), stage (type of stage), lat (latitude), long (longitude), wind (wind speed), and press (pressure).\n  \n  For Data Analysis section, we focused on analyzing data of the North Atlantic Basin from 1980 to 2010. We used the previous cleaned-processed files storms.csv and tracks.csv as sources.\n  \n```{r, echo= FALSE, message = FALSE, warning = FALSE}\n# =============================================================================\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(maps)\nlibrary(ggplot2)\nstorms<-read.csv('../data/storms.csv', stringsAsFactors = FALSE)\ntracks<-read.csv('../data/tracks.csv', stringsAsFactors = FALSE)\n\n# =============================================================================\n# number of storms per year\n# =============================================================================\n\n# first extract years from date\ndate = as.Date(storms$date, '%m/%d/%Y')\nyear = format(date, '%Y')\nyear = year[which(year >= 1980 & year <= 2010)]\n\n# find the frequency of storms in each year\nstormPerYear<-table(year)\nstormPerYear\nbarplot(as.numeric(stormPerYear),names.arg = unique(year),\n        main = 'number of storms per year',\n        xlab = 'Year', ylab = 'number of storms')\n\n# =============================================================================\n# number of storms per year with wind >=35\n# =============================================================================\n# Extract years of which the storm's speed exceed 35\n# tracks$id[tracks$wind>=35]: find all ids of storms that have wind speed exceed 35 mph.\n# unique the id so we know how many storms there are\n# find the date of thoses storms that matches the unique(id)\n# extract the year from date we can get years which storm wind speed exceed 35\ndate = as.Date(tracks$date, '%m/%d/%Y')\nyear = format(date, '%Y')\ntmpTracks = tracks[which(year >= 1980 & year <= 2010),]\nyear35Date = as.Date(storms$date[unique(tmpTracks$id[tmpTracks$wind>=35])], '%m/%d/%Y')\nyear35 = format(year35Date, \"%Y\")\n# using table to find frequency of storms in each year\nstormPerYear35<-table(year35)\nstormPerYear35\nbarplot(as.numeric(stormPerYear35), names.arg=unique(year35), \n        main='number of storms per year with wind >=35',\n        xlab = 'Year', ylab = 'number of storms')\n# =============================================================================\n# number of storms per year with wind >=64\n# =============================================================================\n# years of which the storm's speed exceed 64\n#year64<-str_extract(storms$date[unique(tmpTracks$id[tmpTracks$wind>=64])],'[[:digit:]]{4}')\nyear64Date = as.Date(storms$date[unique(tmpTracks$id[tmpTracks$wind>=64])], '%m/%d/%Y')\nyear64 = format(year64Date, \"%Y\")\n# using table to find frequency of storms in each year\nstormPerYear64<-table(year64)\nstormPerYear64\nbarplot(as.numeric(stormPerYear64), names.arg=unique(year64),\n        main='number of storms per year with wind >= 64',\n        xlab = 'Year', ylab = 'number of storms')\n\n# =============================================================================\n# number of storms per year with wind >=96\n# =============================================================================\n# first extract years of which the storm's speed exceed 96\nyear96Date = as.Date(storms$date[unique(tmpTracks$id[tmpTracks$wind>=96])], '%m/%d/%Y')\nyear96 = format(year96Date, \"%Y\")\n# using table to find frequency of storms in each year\nstormPerYear96<-table(year96)\nstormPerYear96\nbarplot(as.numeric(stormPerYear96), names.arg=unique(year96),\n        main='number of storms per year with wind >= 96',\n        xlab = 'Year', ylab = 'number of storms')\n```\n\n\\newpage\n```{r, echo=FALSE}\ndate = as.Date(storms$date, '%m/%d/%Y')\nmonthWithYear = format(date, '%m/%Y')\nyear = format(date, '%Y')\nmonthWithYear = monthWithYear[year >= 1980 & year <= 2010]\n\n# find the frequency of storms that happened in each month\nmonth = substring(text = monthWithYear, first = 1, last = 2)\nstormPerMonth<-table(month)\n# plot\nmonthName = month.name[sort(as.numeric(unique(month)))]\nstormPerMonth\nbarplot(as.numeric(stormPerMonth), names.arg = monthName,\n        main = 'number of storms per month',\n        xlab = 'Year', ylab = 'number of storms')\n\n# =============================================================================\n# number of storms per month with wind >=35\n# =============================================================================\n# tracks$id[tracks$wind>=35]: find all ids of storms that have wind speed exceed 35 mph.\n# unique the id so we know how many storms there are that wind speed exceed 35\n# find the date of thoses storms that matches the unique(id)\n# extract the month from date we can get years which storm wind speed exceed 35 \ndate = as.Date(tracks$date, '%m/%d/%Y')\nmonthWithYear = format(date, '%m/%Y')\nyear = format(date, '%Y')\ntmpTracks = tracks[which(year >= 1980 & year <= 2010),]\n\n# find the frequency of storms that happened in each month\nmonth35<-storms$date[unique(tmpTracks$id[tmpTracks$wind>=35])]\nmonth35 = as.Date(month35, '%m/%d/%Y')\nmonth35 = format(month35, '%m')\nstormPerMonth35<-table(month35)\n\n# plot\nmonthName = month.name[sort(as.numeric(unique(month35)))]\nstormPerMonth35\nbarplot(as.numeric(stormPerMonth35), names.arg = monthName,\n        main = 'number of storms per month with wind >=35',\n        xlab = 'Year', ylab = 'number of storms')\n\n# =============================================================================\n# number of storms per month with wind >=64\n# =============================================================================\n# find the frequency of storms that happened in each month\nmonth64<-storms$date[unique(tmpTracks$id[tmpTracks$wind>=64])]\nmonth64 = as.Date(month64, '%m/%d/%Y')\nmonth64 = format(month64, '%m')\nstormPerMonth64<-table(month64)\n\n# plot\nmonthName = month.name[sort(as.numeric(unique(month64)))]\nstormPerMonth64\nbarplot(as.numeric(stormPerMonth64), names.arg = monthName,\n        main = 'number of storms per month with wind >=64',\n        xlab = 'Year', ylab = 'number of storms')\n\n# =============================================================================\n# number of storms per month with wind >=96\n# =============================================================================\n# find the frequency of storms that happened in each month\nmonth96<-storms$date[unique(tmpTracks$id[tmpTracks$wind>=96])]\nmonth96 = as.Date(month96, '%m/%d/%Y')\nmonth96 = format(month96, '%m')\nstormPerMonth96<-table(month96)\n\n# plot\nmonthName = month.name[sort(as.numeric(unique(month96)))]\nstormPerMonth96\nbarplot(as.numeric(stormPerMonth96), names.arg = monthName,\n        main = 'number of storms per month with wind >=96',\n        xlab = 'Year', ylab = 'number of storms')\n```\n```{r, echo=FALSE, message= FALSE, warning =FALSE}\n# =============================================================================\n# Annual numbers of storms >= 35/64/96\n# =============================================================================\n## Average \nmean35<-mean(stormPerYear35)\nmean64<-mean(stormPerYear64)\nmean96<-mean(stormPerYear96)\n## std\nstd35<-sd(stormPerYear35)\nstd64<-sd(stormPerYear64)\nstd96<-sd(stormPerYear96)\n## 25 percentile\nQ35<-summary(as.numeric(stormPerYear35))[2]\nQ64<-summary(as.numeric(stormPerYear64))[2]\nQ96<-summary(as.numeric(stormPerYear96))[2]\n## median\nmedian35<-summary(as.numeric(stormPerYear35))[3]\nmedian64<-summary(as.numeric(stormPerYear64))[3]\nmedian96<-summary(as.numeric(stormPerYear96))[3]\n## 75 percentile\nq35<-summary(as.numeric(stormPerYear35))[5]\nq64<-summary(as.numeric(stormPerYear64))[5]\nq96<-summary(as.numeric(stormPerYear96))[5]\n\n## table\nannual<-matrix(c(mean35,std35,Q35, median35,q35,\n                 mean64,std64,Q64, median64,q64,\n                 mean96,std96,Q96, median96,q96), ncol=5, byrow=TRUE)\ncolnames(annual)<-c('Avg','Std.Dev','25th','50th','75th')\nrownames(annual)<-c('35 knots','64 knots', '96 knots')\nannual = signif(annual, 4)\nannual<-as.table(annual)\nannual\n```\n\n\\newpage\n```{r, echo=FALSE, message= FALSE, warning = FALSE}\n# =============================================================================\n# Regression Line\n# =============================================================================\n# mean pressure and mean wind speed for each storm\nvec<-c(1:1777)\npressMean1<-sapply(vec, function(x) \n  mean(tmpTracks$press[tmpTracks$id==x]))\n# remove zeros\npressMean<-pressMean1[pressMean1!=0]\n# mean wind speed\nwindMean1<-sapply(vec,function(x) \n  mean(tmpTracks$wind[tmpTracks$id==x]))\n#remove zeros\nwindMean<- windMean1[pressMean1!=0]\nreg = lm(pressMean ~ windMean)\nplot(windMean, pressMean,xlab = 'mean wind speed', ylab = 'mean pressure')\ntitle('Mean Wind VS Mean Wind Speed for Each Storm ')\nabline(reg)\n\n# =============================================================================\n# Regression analysis 2\n# =============================================================================\n# median pressure and median wind speed for each storm\nvec<-c(1:1777)\npressMedian1<-sapply(vec,function(x) \n  median(tmpTracks$press[tmpTracks$id==x]))\n# mean wind speed\nwindMedian1<-sapply(vec,function(x) \n  median(tmpTracks$wind[tmpTracks$id==x]))\n# remove zeros\npressMedian<-pressMedian1[pressMedian1!=0]\nwindMedian<-windMedian1[pressMedian1!=0]\n\nreg1 = lm(pressMedian ~ windMedian)\nplot(windMedian, pressMedian, xlab = 'Median wind speed', ylab = 'Median pressure')\ntitle('Median Wind Speed VS Median Pressure For Each Storm ')\nabline(reg1)\n\n```\n\n\\newpage\nFor the visualization part of the project involves using data to visualize the trajectory of the storms in both the East Pacific and the North atliantic basins from 1980 to 2010. \n\n```{r, echo= FALSE,message=FALSE, warning=FALSE}\n\n# =============================================================================\n# loading data\n# =============================================================================\nEastP<-read.csv('../rawdata/EastP.csv',skip = 1, header = TRUE)\nNorthA<-read.csv('../rawdata/NorthA.csv', skip=1, header=TRUE)\n\n\n# =============================================================================\n# Preprocessing Data\n# =============================================================================\n\ncleanEP<-EastP[(as.character(EastP$Season)>='1980' & \n                as.character(EastP$Season)<= '2010'),]\ncleanNA<-NorthA[(as.character(NorthA$Season)>='1980' & \n                as.character(NorthA$Season)<= '2010'),]\n\n\n## change the format in each column\ncleanEP$Latitude<-as.numeric(str_trim(as.character(cleanEP$Latitude), side='left'))\ncleanEP$Longitude<-as.numeric(str_trim(as.character(cleanEP$Longitude), side='left'))\ncleanEP$Wind.WMO.<-as.numeric(str_trim(as.character(cleanEP$Wind.WMO.), side='left'))\n\n\n## change the format in each column in North America Basin\ncleanNA$Latitude<-as.numeric(str_trim(as.character(cleanNA$Latitude), side='left'))\ncleanNA$Longitude<-as.numeric(str_trim(as.character(cleanNA$Longitude), side='left'))\ncleanNA$Wind.WMO.<-as.numeric(str_trim(as.character(cleanNA$Wind.WMO.), side='left'))\n\n## Combine the two data frame\n# clean<-rbind(cleanEP, cleanNA)\nclean<- full_join(cleanEP, cleanNA)\n\n## change Serial_Num column to factor\nclean$Serial_Num<-as.factor(clean$Serial_Num)\n\n## Extract Month\nclean$Month<-str_replace_all(str_extract(as.character(clean$ISO_time),\n            '-[0-9]{2}-'),'-','')\nclean$Month<-factor(clean$Month, labels=month.name)\n\n# gather world map data from maps package\nmapdata<-map_data('world')\n```\n\nVisulization 1: Trajectory of storms from 1980 to 2010\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=12}\nglobalmap<- ggplot(clean, aes(x=Longitude, y=Latitude, group=Serial_Num)) +\n  geom_polygon(data=mapdata, aes(x=long, y=lat, group=group),\n               fill='#000050', colour='#000050', size=0.5) +\n  geom_path(data=clean, aes(group=Serial_Num, colour=Wind.WMO.), alpha=0.5, size=0.5) +\n  ggtitle('Trajectory of storms from 1980 to 2010')+\n  scale_color_continuous(name='Wind (knot)',low = '#E68A00',high = '#4C2E00',\n                         space = 'Lab',guide = 'colourbar')+\n  xlim(-150, -25) + ylim(5, 60)+\n  theme(panel.background = element_rect(fill='#00006BDD',colour='#00006BDD'),\n        panel.grid = element_blank(),\n        panel.border = element_blank())\n\nlibrary(png)\nlibrary(grid)\ngrid.raster(readPNG(\"../images/globalMap.png\"))\n\n```\n\n\\newpage\nVisulization 2: Trajectory of storms per month from 1980 to 2010\n(one facet per month)\n\n```{r, echo=FALSE, message= FALSE, warning= FALSE, fig.width=12, fig.height=12}\nstormbymonth <- ggplot(clean, aes(x=Longitude, y=Latitude, group=Serial_Num)) +\n  geom_polygon(data=map_data(\"world\"), aes(x=long, y=lat, group=group),\n               fill='#000050', colour='#000050', size=0.5) +\n  geom_path(data=clean, aes(group=Serial_Num, colour=Wind.WMO.), \n            alpha=0.2,size=0.5) +\n  ggtitle('Trajectory of storms per month from 1980 to 2010')+\n  scale_color_continuous(name='Wind (knot)',low = '#E68A00',high = '#4C2E00',\n                         space = 'Lab',guide = 'colourbar')+\n  xlim(-150, -25) + ylim(5, 60)+facet_wrap(~ Month)+\n  theme(panel.background = element_rect(fill='#00006BDD',colour='#00006BDD'),\n        panel.grid = element_blank(),\n        panel.border = element_blank())\n\ngrid.raster(readPNG(\"../images/stormByMonth.png\"))\n```\n\n\\newpage\nVisulization 3: trajectory of storms in decade 1980s \n(one facet per year)\n\n```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width=12, fig.height=12}\n# extract storms from 1980 to 1989\ntraj1980<-clean[as.character(clean$Season)>='1980' & \n                as.character(clean$Season)<='1989',]\n\n# As. factor Season column in the data frame\ntraj1980$Season<-as.factor(traj1980$Season)\n\n# plot map\nmap1980 <- ggplot(traj1980, aes(x=Longitude, y=Latitude, group=Serial_Num)) +\n  geom_polygon(data=map_data(\"world\"), aes(x=long, y=lat, group=group),\n               fill='#000050', colour='#000050', size=0.5) +\n  geom_path(data=traj1980, aes(group=Serial_Num, colour=Wind.WMO.),alpha=0.2, size=0.5) +\n  ggtitle('Trajectory of storms per month from 1980 to 1989')+\n  scale_color_continuous(name='Wind (knot)',low = '#E68A00',high = '#4C2E00',\n                         space = 'Lab',guide = 'colourbar')+\n  xlim(-150, -25) + ylim(5, 60)+facet_wrap(~ Season)+\n  theme(panel.background = element_rect(fill='#00006BDD',colour='#00006BDD'),\n        panel.grid = element_blank(),\n        panel.border = element_blank())\n\ngrid.raster(readPNG(\"../images/stormsIn1980s.png\"))\n```\n\n\\newpage\nVisulization 4: trajectory of storms in decade 1990s \n(one facet per year)\n\n```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width=12, fig.height=12}\n# Extract storms from 1990 to 1999\ntraj1990<-clean[as.character(clean$Season)>='1990' & \n                as.character(clean$Season)<='1999',]\n\n# As. factor Season column in the storm data frame\ntraj1990$Season<-as.factor(traj1990$Season)\n\n# plot map\nmap1990 <- ggplot(traj1990, aes(x=Longitude, y=Latitude, group=Serial_Num)) +\n  geom_polygon(data=map_data(\"world\"), aes(x=long, y=lat, group=group),\n               fill='#000050', colour='#000050', size=0.5) +\n  geom_path(data=traj1990, aes(group=Serial_Num, colour=Wind.WMO.), \n            alpha=0.2, size=0.5)+\n  ggtitle('Trajectory of storms per month from 1990 to 1999')+\n  scale_color_continuous(name='Wind (knot)',low = '#E68A00',high = '#4C2E00',\n                         space = 'Lab',guide = 'colourbar')+\n  xlim(-150, -25) + ylim(5, 60)+facet_wrap(~ Season)+\n  theme(panel.background = element_rect(fill='#00006BDD',colour='#00006BDD'),\n        panel.grid = element_blank(),\n        panel.border = element_blank())\n\ngrid.raster(readPNG(\"../images/stormsIn1990s.png\"))\n\n```\n\n\\newpage\nVisulization 5: trajectory of storms in decade 2000s \n(one facet per year)\n\n```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.width=12, fig.height=12}\n\n# Extract storms from 2000 to 2009\ntraj2000<-clean[as.character(clean$Season)>='2000' & \n                as.character(clean$Season)<='2009',]\n\n# As. factor Season column in the storm data frame\ntraj2000$Season<-as.factor(traj2000$Season)\n\n# plot map\nmap2000 <- ggplot(traj2000, aes(x=Longitude, y=Latitude, group=Serial_Num)) +\n  geom_polygon(data=map_data(\"world\"), aes(x=long, y=lat, group=group),\n               fill='#000050', colour='#000050', size=0.5) +\n  geom_path(data=traj2000, aes(group=Serial_Num, colour=Wind.WMO.),\n            alpha=0.2, size=0.5) +\n  ggtitle('Trajectory of storms per month from 2000 to 2009')+\n  scale_color_continuous(name='Wind (knot)',low = '#E68A00',high = '#4C2E00',\n                         space = 'Lab',guide = 'colourbar')+\n  xlim(-150, -25) + ylim(5, 60)+facet_wrap(~ Season)+\n  theme(panel.background = element_rect(fill='#00006BDD',colour='#00006BDD'),\n        panel.grid = element_blank(),\n        panel.border = element_blank())\n\ngrid.raster(readPNG(\"../images/stormsIn2000s.png\"))\n```\n\nExtra Credit:\n\nGithub: https://github.com/isaaclzq/stat133_project.git\n\nLinkedIn: https://www.linkedin.com/pulse/storm-project-tong-zhang?trk=prof-post\n",
    "created" : 1439599493221.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3087346225",
    "id" : "707AEE2F",
    "lastKnownWriteTime" : 1439599496,
    "path" : "~/Dropbox/stat133_final/Final/report/Report.Rmd",
    "project_path" : "report/Report.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_markdown"
}